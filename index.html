<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Hell Of World公式ホームページ</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1><img src="images/title.png" alt="Hell Of World 公式ホームページ"><br>公式ホームページ</h1>
  <h2><a href="https://2024tonegonproject.github.io/Hell-of-World-official-site/discussion">ディスカッションフォーラム(デモ版)</a></h2>
  <p>
  <a class="Hl" href="#gene">1.概要</a><br>
  <a class="Hl" href="#prog">2.開発状況</a><br>
  <a class="Hl" href="#creats">3.制作者</a><br>
  <a class="Hl" href="#Setts">4.設定</a><br>
  <a class="Hl" href="#Story">└ストーリー</a><br>
  <a class="Hl" href="#Char">└キャラクター</a><br>
  <a class="Hl" href="#comment_a">コメント欄(アカウント必要)</a><br>
  <a class="Hl" href="#comments">コメント欄(アカウント不要)</a><br>
  </p>
  <p id="gene">
    Hell of worldは
    <a href="https://scratch.mit.edu/users/siratama1538/">Siratama1538</a>
    氏が考案した
    <a href="https://undertale.jp/">UNDERTALE</a>
    AUです。
  </p>
  <p>
    現在
    <a href="https://ja.scratch-wiki.info/">Scratch</a>上で開発しています。</p>
    <p id="prog">
      開発状況:<br>
      シナリオ＆設定など:20%<br>
      絵やスプライト:30%<br>
      曲:50%<br>
      制作者:</p>
      <div class="ctrs" id="creats">
        <a href="https://scratch.mit.edu/users/siratama1538/">
          <img src="images/Siratama1538.png" class="Icons" alt="Icon">
        </a>
        <span class="name">
          <a href="https://scratch.mit.edu/users/siratama1538/">
            @siratama1538
          </a>:ホスト
        </span>
      </div>

      <div class="ctrs">
        <a href="https://scratch.mit.edu/users/Yuufu_SCYT_pro42/">
          <img src="images/y_sy_pro42.png" class="Icons" alt="Icon">
        </a>
        <span class="name">
          <a href="https://scratch.mit.edu/users/Yuufu_SCYT_pro42/">
            @Yuufu_SCYT_pro42
          </a>:攻撃案/セリフ案など
        </span>
      </div>

      <div class="ctrs">
        <a href="https://scratch.mit.edu/users/Reonomati/">
          <img src="images/Reonomati.gif" class="Icons" alt="Icon">
        </a>
        <span class="name">
          <a href="https://scratch.mit.edu/users/Reonomati/">
            @Reonomati
          </a>
        </span>
      </div>
      
      <div class="ctrs">
        <a href="https://scratch.mit.edu/users/Heroburain666/">
          <img src="images/Heroburain.gif" class="Icons" alt="Icon">
        </a>
        <span class="name">
          <a href="https://scratch.mit.edu/users/Heroburain666/">
            @Heroburain666
          </a>:色々な枠の動きのプログラム
        </span>
      </div>
      
      <div class="ctrs">
        <a href="https://scratch.mit.edu/users/2024tonegonproject/">
          <img src="images/俺.png" class="Icons" alt="Icon">
        </a>
        <span class="name">
          <a href="https://scratch.mit.edu/users/2024tonegonproject/">
            @2024tonegonproject
          </a>:なんかやりました。(曲の作成)
        </span>
      </div>
      
      <div class="ctrs">
        <a href="https://scratch.mit.edu/users/Lightblue1412/">
          <img src="images/default.png" class="Icons" alt="Icon">
        </a>
        <span class="name">
          <a href="https://scratch.mit.edu/users/Lightblue1412/">
            @Lightblue1412
          </a>
        </span>
      </div>
      
      <div class="ctrs">
        <a href="https://scratch.mit.edu/users/Futurary_Watcher/">
          <img src="images/Futur_watc.png" class="Icons" alt="Icon">
        </a>
        <span class="name">
          <a href="https://scratch.mit.edu/users/Futurary_Watcher/">
            @Futurary_Watcher
          </a>(?):攻撃案
        </span>
      </div>

      <div class="ctrs">
        <a href="https://scratch.mit.edu/users/take_take_take/">
          <img src="images/take.png" class="Icons" alt="Icon">
        </a>
        <span class="name">
          <a href="https://scratch.mit.edu/users/take_take_take/">
            @take_take_take
          </a>
        </span>
      </div>

      <div class="ctrs">
        <a href="https://scratch.mit.edu/users/Xx_void_solo_xX/">
          <img src="images/Void_solo.jpg" class="Icons" alt="Icon">
        </a>
        <span class="name">
          <a href="https://scratch.mit.edu/users/Xx_void_solo_xX/">
            @Xx_void_solo_xX
          </a>
        </span>
      </div>

      <div class="ctrs">
        <a href="https://scratch.mit.edu/users/Jellyfish3955/">
          <img src="images/Jellyfish3955.png" class="Icons" alt="Icon">
        </a>
        <span class="name">
          <a href="https://scratch.mit.edu/users/Jellyfish3955/">
            @Jellyfish3955
          </a>
        </span>
      </div>

      <div class="ctrs">
        <a href="https://scratch.mit.edu/users/kurigohan_dayo/">
          <img src="images/kurigohan.png" class="Icons" alt="Icon">
        </a>
        <span class="name">
          <a href="https://scratch.mit.edu/users/kurigohan_dayo/">
            @kurigohan_dayo
          </a>
        </span>
      </div>

      <div class="ctrs">
        <a href="https://scratch.mit.edu/users/dustxyz/">
          <img src="images/dustxyz.png" class="Icons" alt="Icon">
        </a>
        <span class="name">
          <a href="https://scratch.mit.edu/users/dustxyz/">
            @dustxyz
          </a>一言コメント:＊dustxyzだ...<br>普段はサボっているが...<br>今回は気合が入っているようだ....
        </span>
      </div>

      <p>
      <br>
      youtube Chiryoru(   ᐕ)<br>
      <br>
      オマージュした作品・作者<br>
      <a href="https://undertale-au.fandom.com/ja/wiki/Chaos%27end">chao's end asriel fight</a><br>
      <a href="https://scratch.mit.edu/users/Yuufu_SCYT_pro42/">@Yuufu_SCYT_pro42</a><br>
      <a href="https://scratch.mit.edu/users/chara-YTsab/">@chara-YTsab</a><br>
      (<a href="https://scratch.mit.edu/studios/50976499/">公式Scratchスタジオ</a>引用)<br>
      </p><h1 id="Setts">設定</h1>
      <h2 id="Story">ストーリー</h2>
    <p>アリスは2009年に生まれた...そしてしばらくして<br>
      2XXX年 アリスは二度と入ったら戻ってくることのできないといわれる洞窟に足を踏み入れた<br>
      そこでアリスは足を滑らせとても深い穴へ落ちてしまった...<br>
    </p>
      <h2 id="Char">キャラクター</h2>
      <h3>主人公:</h3>
    <p>名前：アリス(翼をはやすこともできるが飛べない)<br>
      性格：優しい<br>
      ソウル：濃い赤(ケツイ+ダメージ軽減)<br>
      攻撃技：火<br>
      P：通常通り優しいモンスターも積極的によってくる<br>
      N：ノーマル 優しくも時には厳しいルート<br>
      G：ボスは自分自身。最後の力を振り絞って戦う<br>
    </p>
      <h3>主なキャラクター:</h3>
    <p>サンズ：洞窟の深い穴の中にいる陽気なスケルトン<br>
      よくつまらないギャグを言ってるが戦いの腕はいいらしい(パピルスによると)<br>
      <br>
      パピルス：サンズの弟。つまらないギャグをいつも言っている。<br>サンズにあきれているが戦いの実力は申し分ないのであきらめている<br>
      <br>
      フラウィ：クO花ではなく、この世界では優しい<br>
      <br>
      アカリ：charaポジ<br>
      アリスとアカリの性別はどっちも女性<br>
      (<a href="https://scratch.mit.edu/projects/1228512204">考案されたプロジェクト引用</a>)<br>
      <br>
      お問い合わせはScratchの<a href="https://scratch.mit.edu/users/siratama1538">Siratama1538氏</a>またはYouTubeの<a href="https://www.youtube.com/channel/UC5xjAGbVGm8nkizfZ0VB7bA">Siratama Games</a>へ
    </p>
        <h1>コメント欄(Githubアカウント不要、ディスカッションと同じ)</h1>
    <form id="commentForm">
  <input type="text" id="name" placeholder="名前" required>
  <textarea id="message" placeholder="メッセージ" required></textarea>
  <button type="submit">送信</button>
  
  <div id="comments"></div>

</form>
    <div class="no-fade" id="comments"></div>
    <h1 id="comment_a">コメント欄(Githubアカウント必要)</h1>
    <p>アカウント登録は<a href="https://github.com">こちら</a>からできます。</p>
    <script src="https://giscus.app/client.js"
        data-repo="2024tonegonproject/Hell-of-World-official-site"
        data-repo-id="R_kgDOQvIQjw"
        data-category="General"
        data-category-id="DIC_kwDOQvIQj84C0VVA"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="ja"
        crossorigin="anonymous"
        async>
    </script>
    <p>ここに表示されていない場合はリロードまたはスーパーリロード(Microsoft Edgeではctrl+shift+R(ほかのブラウザのスーパーリロードについては調べてみてください))してください</p>

    <a href="https://auth.itinerary.eu.org/auth?redirect=https%253A%252F%252F2024tonegonproject.github.io%252FHell-of-World-official-site%252Fcallback.html">Scratch でログイン(ベータ版)</a>
    
      <h5>© 2025 2024tonegonproject | Hell of World © 2025 Siratama1538 | UNDERTALE © Toby Fox 2013–2025. All rights reserved.<br>
      This site Is a UNDERTALE's fan-made game "Hell of World" site.<br>
      このサイトはUNDERTALEのファンメイドゲーム、「Hell of World」のサイトです。<br>
      </h5>
<script>
const targets = document.querySelectorAll('body *');
const observer = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      entry.target.classList.add('show');
      observer.unobserve(entry.target);
    }
  });
});
targets.forEach(target => observer.observe(target));
</script>

<script>
const WORKER_URL = "https://noisy-sound-60af.tgrk-2024tgproject-official.workers.dev/";

async function loadComments() {
  const params = new URLSearchParams(location.search);
  const discussionId = params.get("discussion");

  const res = await fetch(WORKER_URL);
  const comments = await res.json();

  console.log("取得した comments:", comments); 

  if (!discussionId) {
    loadDiscussions(comments);
    return;
  }

  const filtered = comments.filter(c => c.discussionId === discussionId);

  const container = document.getElementById("comments");
  container.innerHTML = "";

  renderTree(filtered, null, container, 0);
}


/* -----------------------------------
   無限ネスト対応のツリー描画
----------------------------------- */
function renderTree(comments, parentId, container, level) {
  comments
    .filter(c => c.parent === parentId)
    .sort((a, b) => b.date - a.date)
    .forEach(c => {
      if (level === 0) {
        renderComment(c, container, comments, level);
      } else {
        renderReply(c, container, comments, level);
      }

      renderTree(comments, c.id, container, level + 1);
    });
}

/* -----------------------------------
   親コメントの描画
----------------------------------- */
function renderComment(c, container, comments, level) {
  const div = document.createElement("div");
  div.id = c.id;
  div.className = "comment-box fade-up show";
  div.style.marginLeft = (level * 20) + "px";

  const date = new Date(c.date).toLocaleString();

  div.innerHTML = `
    <strong>${c.name}</strong> <span style="opacity:0.7;">(${date})</span><br>
    ${c.message}<br>
    <button onclick="replyTo('${c.id}')">返信</button>
    <button onclick="deleteComment('${c.id}')">削除</button>
  `;

  container.appendChild(div);
}

/* -----------------------------------
   返信コメントの描画
----------------------------------- */
function renderReply(c, container, comments, level) {
  const div = document.createElement("div");
  div.id = c.id;
  div.className = "reply-box fade-up show";
  div.style.marginLeft = (level * 20) + "px";

  const date = new Date(c.date).toLocaleString();
  const parentComment = comments.find(x => x.id === c.parent);
  const parentName = parentComment ? parentComment.name : "不明";

  div.innerHTML = `
    ↳ <strong>${c.name}</strong> <span style="opacity:0.7;">(${date})</span><br>
    <span style="opacity:0.7;">@${parentName}</span><br>
    ${c.message}<br>
    <button onclick="replyTo('${c.id}')">返信</button>
    <button onclick="deleteComment('${c.id}')">削除</button>
  `;

  container.appendChild(div);
}

/* -----------------------------------
   新規コメント投稿（discussion対応）
----------------------------------- */
document.getElementById("commentForm")?.addEventListener("submit", async (e) => {
  e.preventDefault();

  const params = new URLSearchParams(location.search);
  const discussionId = params.get("discussion");

  const name = document.getElementById("name").value;
  const message = document.getElementById("message").value;

  await fetch(WORKER_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ discussionId, name, message })
  });

  document.getElementById("message").value = "";
  loadComments();
});

/* -----------------------------------
   返信投稿（discussion対応）
----------------------------------- */
function replyTo(parentId) {
  // すでにフォームが出ていたら消す
  const oldForm = document.getElementById("replyForm");
  if (oldForm) oldForm.remove();

  // フォームを作る
  const form = document.createElement("div");
  form.id = "replyForm";
  form.style.margin = "10px 0";
  form.style.padding = "10px";
  form.style.border = "1px solid #ccc";
  form.style.borderRadius = "6px";
  form.style.background = "#fafafa";

  form.innerHTML = `
    <input id="replyName" placeholder="名前" style="display:block; margin-bottom:5px; width:200px;">
    <textarea id="replyMessage" placeholder="返信内容" style="display:block; margin-bottom:5px; width:300px; height:60px;"></textarea>
    <button id="replySend">送信</button>
  `;

  // 親コメントの下に挿入
  const parentDiv = document.getElementById(parentId);
  parentDiv.after(form);

  // 送信処理
  document.getElementById("replySend").onclick = async () => {
    const name = document.getElementById("replyName").value;
    const message = document.getElementById("replyMessage").value;

    if (!message) return;

    await fetch(WORKER_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        discussionId: new URLSearchParams(location.search).get("discussion"),
        name,
        message,
        parent: parentId
      })
    });

    form.remove();
    loadComments();
  };
}

/* -----------------------------------
   コメント削除
----------------------------------- */
function deleteComment(id) {
  if (!confirm("本当に削除しますか？")) return;

  fetch(WORKER_URL + "?id=" + id, {
    method: "DELETE"
  }).then(() => loadComments());
}

/* -----------------------------------
   初回ロード
----------------------------------- */
loadComments();
</script>
</body>
</html>
